version: '3.8'

services:
  freeswitch:
    image: freeswitch/freeswitch:latest
    container_name: freeswitch
    ports:
      - "5060:5060/udp"   # SIP
      - "5060:5060/tcp"   # SIP
      - "7443:7443/tcp"   # WSS (WebRTC)
      - "8080:8080/tcp"   # HTTP API
      - "8081:8081/tcp"   # Event Socket
      - "8021:8021/tcp"   # ESL (Event Socket Library)
    volumes:
      - ./dialplan:/etc/freeswitch/dialplan/default
      - ./vars.xml:/etc/freeswitch/vars.xml
      - ./scripts:/usr/share/freeswitch/scripts
      - ./recordings:/var/freeswitch/recordings
    environment:
      - FS_EVENT_SOCKET=0.0.0.0:8021
      - FS_EVENT_SOCKET_PASSWORD=ClueCon
      - BACKEND_URL=http://aidevelo:5000
    networks:
      - default
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "fs_cli", "-x", "status"]
      interval: 30s
      timeout: 10s
      retries: 3

